/* nice Validator 0.6.3
 * (c) 2012-2013 Jony Zhang <zj86@live.cn>, MIT Licensed
 * http://niceue.com/validator/
 */
!function(G,Aw){function AB(A,E){var C,D,B=this;return !B instanceof AB?new AB(A,E):(At(E)&&(E={valid:E}),E=E||{},D=Y(A,"data-"+As+"-option"),D=D&&"{"===D.charAt(0)?Function("return "+D)():{},C=Ai[E.theme||D.theme||Ac.theme],B.options=G.extend({},Ac,C,D,E),B.$el=G(A),B.rules=new Aq(B.options.rules,!0),B.messages=new AC(B.options.messages,!0),B.elements={},B.fields={},B.deferred={},B.errors={},B._init(),Aw)}function Aq(B,D){var A=D?D===!0?this:D:Aq.prototype;if(Ag(B)){for(var C in B){A[C]=Ar(B[C])}}}function AC(B,D){var A=D?D===!0?this:D:AC.prototype;if(Ag(B)){for(var C in B){if(!B[C]){return}A[C]=B[C]}}}function Ar(A){switch(G.type(A)){case"function":return A;case"array":return function(B){return A[0].test(B.value)||A[1]||!1};case"regexp":return function(B){return A.test(B.value)}}}function AI(B){var A="";return G.map(B.split(" "),function(C){A+=","+("#"===C.charAt(0)?C:'[name="'+C+'"]')}),A.substring(1)}function AE(B){var A;if(B&&B.tagName){switch(B.tagName){case"INPUT":case"SELECT":case"TEXTAREA":case"BUTTON":case"FIELDSET":A=B.form||G(B).closest(".n-"+As);break;case"FORM":A=B;break;default:A=G(B).closest(".n-"+As)}return G(A).data(As)||G(A)[As]().data(As)}}function Ax(C,A){if(C.form&&null===Y(C.form,Ak)){var B=AE(C);B?(B._parse(C),G(C).trigger(A)):Y(C,Ah,null)}}function AD(A,B){var C=G.trim(Y(A,Ah+"-"+B));if(C){return C=Function("return "+C)(),C?Ar(C):Aw}}function AH(B,D,A){var C=D.msg;return Ag(C)&&A&&(C=C[A]),J(C)||(C=Y(B,"data-msg-"+A)||Y(B,"data-msg")||""),C}function AL(A){var B;return A&&(B=Al.exec(A)),B?B[1]:""}function AJ(A){return"INPUT"===A.tagName&&"checkbox"===A.type||"radio"===A.type}function AK(A){return Date.parse(A.replace(/\.|\-/g,"/"))}var As="validator",AA="n-ok",AF="n-error",Au="n-tip",Ap="n-loading",AG="n-valid",Az="n-invalid",K="msg-box",Av="aria-invalid",Ah="data-rule",Af="data-target",Ao="data-tip",Ad="data-inputstatus",Ak="novalidate",Aa=":verifiable",Z=/(\w+)(?:\[(.*)\]$|\((.*)\)$)?/,X=/(?:([^:;\(\[]*):)?(.*)/,Aj=/[^\x00-\xff]/g,Al=/^.*(top|right|bottom|left).*$/,Q=/(?:(post|get):)?(.+)/i,Ae=/<|>/g,An=G.noop,Ay=G.proxy,At=G.isFunction,Am=G.isArray,J=function(A){return"string"==typeof A},Ag=function(A){return A&&"[object Object]"===Object.prototype.toString.call(A)},z=!window.XMLHttpRequest,Y=function(B,A,C){return C===Aw?B.getAttribute(A):(null===C?B.removeAttribute(A):B.setAttribute(A,""+C),Aw)},Ab=window.console||{log:An},Ac={debug:0,timely:1,theme:"default",stopOnError:!1,ignore:"",msgWrapper:"span",msgMaker:function(B){var C,A={error:AF,ok:AA,tip:Au,loading:Ap}[B.type];return C='<span class="msg-wrap '+A+'" role="alert">',C+=(B.arrow||"")+(B.icon||"")+'<span class="n-msg">'+B.msg+"</span>",C+="</span>"},msgIcon:'<span class="n-icon"></span>',msgArrow:"",msgClass:"",defaultMsg:"{0} 无效.",loadingMsg:"Validating..."},Ai={"default":{formClass:"n-default",msgClass:"n-right",showOk:""}};G.fn[As]=function(C){var A=this,B=arguments;return A.is(":input")?A:(!A.is("form")&&(A=this.find("form")),!A.length&&(A=this),A.each(function(){if(J(C)){if("_"===C.charAt(0)){return}var D=G(this).data(As);D&&D[C].apply(D,Array.prototype.slice.call(B,1))}else{new AB(this,C)}}),this)},G.fn.isValid=function(B,A){var C,D,E=AE(this[0]);return E?(A===Aw&&(A=!0),E.checkOnly=A,C=this.is(":input")?this:this.find(Aa),D=E._multiValidate(C,function(F){At(B)&&B.call(null,F),E.checkOnly=!1},!0),At(B)?this:D):!0},G.expr[":"].verifiable=function(A){var B=A.nodeName.toLowerCase();return("input"===B&&"submit"!==A.type&&"button"!==A.type&&"reset"!==A.type||"select"===B||"textarea"===B)&&A.disabled===!1&&null===Y(A,Ak)},AB.prototype={_init:function(){var E=this,A=E.options,B=E.fields,C=E.$el[0];if(Am(A.groups)&&G.map(A.groups,function(F){if(!J(F.fields)||!At(F.callback)){return null}var H=E.$el.find(AI(F.fields)),I=function(){return F.callback.call(E,H)};G.extend(I,F),G.map(F.fields.split(" "),function(L){B[L]=B[L]||{},B[L].group=I})}),Ag(A.fields)&&G.each(A.fields,function(F,H){H&&(B[F]=J(H)?{rule:H}:H)}),E.$el.find(Aa).each(function(){E._parse(this)}),E.msgOpt={type:"error",pos:AL(A.msgClass),wrapper:A.msgWrapper,cls:A.msgClass,style:A.msgStyle,icon:A.msgIcon,arrow:A.msgArrow,show:A.msgShow,hide:A.msgHide},A.valid||null===Y(C,"action")){E.isAjaxSubmit=!0}else{var D=G[G._data?"_data":"data"](C,"events");E.isAjaxSubmit=D&&D.valid&&G.map(D.valid,function(F){return -1!==F.namespace.indexOf("form")?1:null}).length?!0:!1}E.$el.data(As)||(E.$el.on("submit."+As+" validate."+As,Ay(E,"_submit")).on("reset."+As,Ay(E,"_reset")).on("showtip."+As,Ay(E,"_showTip")).on("validated.field."+As,Aa,Ay(E,"_validatedField")).on("validated.rule."+As,Aa,Ay(E,"_validatedRule")).on("focusin."+As+" click."+As+" showtip."+As,Aa,Ay(E,"_focus")).on("focusout."+As+" validate."+As,Aa,Ay(E,"_blur")).on("click."+As,"input:radio,input:checkbox",Ay(E,"_click")),A.timely>=2&&E.$el.on("keyup."+As+" paste."+As,Aa,Ay(E,"_blur")).on("change."+As,"select",Ay(E,"_click")),E.$el.data(As,E).addClass("n-"+As+" "+A.formClass),E.NOVALIDATE=Y(C,Ak),Y(C,Ak,Ak))},_multiValidate:function(A,B,C){var D=this,E=D.options;return D.isValid=!0,D.deferred={},E.ignore&&(A=A.not(E.ignore)),A.each(function(H,F){var I=D.getField(F);if(I){return D._validate(F,I,C),!D.isValid&&E.stopOnError?!1:Aw}}),G.when.apply(null,G.map(D.deferred,function(F){return F})).done(function(){B.call(D,D.isValid)}),G.isEmptyObject(D.deferred)?D.isValid:Aw},_submit:function(A,B){var C,D=this,F=D.options,E=A.target;if(Y(E,"novalidateonce")){return Y(E,"novalidateonce",null),Aw}if("only"!==B&&("validate"!==A.type||D.$el[0]===E)){if(D.submiting){return At(D.submiting)&&D.submiting.call(D),A.preventDefault(),Aw}if(At(F.beforeSubmit)&&F.beforeSubmit.call(D,E)===!1){return D.isAjaxSubmit&&A.preventDefault(),Aw}D._reset(),D.submiting=!0,F.debug&&Ab.log("\n%c########## "+A.type+" form ##########","color:blue"),C=D._multiValidate(D.$el.find(Aa),function(M){var H,I="focus.field",L=M||2===F.debug?"valid":"invalid";if(!M){var N=D.$el.find(":input."+Az+":first");N.trigger(I),z&&N.trigger(I),H=G.map(D.errors,function(O){return O})}D.submiting=!1,At(F[L])&&F[L].call(D,E,H),D.$el.trigger(L+".form",[E,H]),M&&!D.isAjaxSubmit&&G(E).trigger("submit",["only"])}),(!C||D.isAjaxSubmit)&&A.preventDefault()}},_reset:function(B){var A=this;A.errors={},B&&A.$el.find(":verifiable").each(function(D,C){A.hideMsg(C),Y(C,Ad,null),Y(C,Av,null),G(C).removeClass(AG+" "+Az)})},_focus:function(B){var C,A=B.target;if("showtip"!==B.type){if(B.isTrigger||this.submiting){return}if(""!==A.value&&("false"===Y(A,Av)||"tip"===Y(A,Ad))){return}}C=Y(A,Ao),C&&this.showMsg(A,{msg:C,type:"tip"})},_blur:function(C,E){var A,F,B=this,M=B.options,I=C.target,D=C.type,H=150;if(!E&&"paste"!==D){if("validate"===D){F=!0,H=0}else{if(Y(I,"notimely")){return}if(M.timely>=2&&"keyup"!==D){return}}if(M.ignore&&G(I).is(M.ignore)){return}if("keyup"===D){var L=C.keyCode,N={8:1,9:1,16:1,32:1,46:1};if(9===L&&!I.value){return}if(48>L&&!N[L]){return}H=M.timely>=100?M.timely:500}}A=B.getField(I),A&&(H?(A.timeout&&clearTimeout(A.timeout),A.timeout=setTimeout(function(){B.submiting||B._validate(I,A,F)},H)):B._validate(I,A,F))},_click:function(A){this._blur(A,!0)},_showTip:function(A){var B=this;B.$el[0]===A.target&&B.$el.find(":verifiable["+Ao+"]").each(function(){B.showMsg(this,{msg:Y(this,Ao),type:"tip"})})},_parse:function(B){var E,A=this,C=B.name,D=Y(B,Ah);D&&Y(B,Ah,null),(B.id&&"#"+B.id in A.fields||!B.name)&&(C="#"+B.id),C&&(E=A.fields[C]||{},E.rule=E.rule||D||"",E.rule&&(E.key=C,E.required=-1!==E.rule.indexOf("required"),E.must=E.must||!!E.rule.match(/match|checked/),E.required&&Y(B,"aria-required",!0),("timely" in E&&!E.timely||!A.options.timely)&&Y(B,"notimely",!0),J(E.target)&&Y(B,Af,E.target),J(E.tip)&&Y(B,Ao,E.tip),A.fields[C]=A._parseRule(E)))},_parseRule:function(A){var B,C=X.exec(A.rule);if(C){return A.display=C[1],A.rules=[],B=(C[2]||"").split(";"),G.map(B,function(D){var E=Z.exec(D);return E?(E[3]&&(E[2]=E[3]),A.rules.push({method:E[1],params:E[2]?G.trim(E[2]).split(", "):Aw}),Aw):null}),A.vid=0,A.rid=A.rules[0].method,A}},_validatedField:function(C,E,A){var F=this,B=F.options,I=C.target,H=A.isValid=E.isValid=!!A.isValid,D=H?"valid":"invalid";A.key=E.key,A.rule=E.rid,H?A.type="ok":(F.submiting&&(F.errors[E.key]=A.msg),F.isValid=!1),E.old.ret=A,E.old.value=I.value,F.elements[E.key]=I,F.checkOnly||(At(E[D])&&E[D].call(F,I,A),G(I).attr(Av,!H).addClass(H?AG:Az).removeClass(H?Az:AG).trigger(D+".field",[A,F]),(E.msgMaker||B.msgMaker)&&(!A.showOk&&A.msg||A.showOk&&B.showOk!==!1?F.showMsg(I,A,E):F.hideMsg(I,A,E)))},_validatedRule:function(E,A,F,B){var L,I=this,D=I.options,H=E.target,O="",M=!1,N=!1;if(B=B||{},A=A||I.getField(H),L=A.rid,F===!0||F===Aw?M=!0:(O=AH(H,A,L),O||(J(F)?(O=F,F={error:O}):Ag(F)&&(F.error?O=F.error:(M=!0,F.ok&&J(F.ok)&&(N=!0),O=F.ok))),B.msg=(M?O:O||I.messages[L]||Ac.defaultMsg).replace("{0}",A.display||"")),M){if(B.isValid=!0,!N){var C=A.ok||Y(H,"data-ok");C?(N=!0,B.msg=C):J(D.showOk)&&(N=!0,B.msg=D.showOk)}B.showOk=N,G(H).trigger("valid.rule",[L,B.msg])}else{G(H).trigger("invalid.rule",[L,B.msg])}D.debug&&Ab.log("   %c"+A.vid+": "+L+" => "+(B.msg||!0),M?"color:green":"color:red"),M&&A.vid<A.rules.length-1?(A.vid++,I._checkRule(H,A)):(A.vid=0,G(H).trigger("validated.field",[A,B]))},_checkRule:function(D,A){var E,B=this,I=A.key,F=A.rules[A.vid],C=F.method,H=F.params;if(!B.submiting||!B.deferred[I]){if(A.rid=C,E=(AD(D,C)||B.rules[C]||function(){return !0}).call(B,D,H,A),Ag(E)&&At(E.then)){var L=function(M){return J(M)||Ag(M)&&("error" in M||"ok" in M)?M:Aw};B.deferred[I]=E,!B.checkOnly&&B.showMsg(D,{type:"loading",msg:B.options.loadingMsg},A),E.then(function(M,S,O){var R,N=O.responseText,P=A.dataFilter||B.options.dataFilter;"json"===this.dataType?N=M:"{"===N.charAt(0)&&(N=G.parseJSON(N)||{}),At(P)?N=P(N):""===N?N=!0:(R=L(N),R===Aw&&(R=L(N.data)),N=R||!0),G(D).trigger("validated.rule",[A,N])},function(N,M){G(D).trigger("validated.rule",[A,M])}),A.isValid=Aw}else{null===E?G(D).trigger("validated.field",[A,{isValid:!0}]):G(D).trigger("validated.rule",[A,E])}}},_validate:function(D,A,E){if(!D.disabled&&null===Y(D,Ak)){A.rules||this._parse(D);var B,L,H=this,C=H.options,F=G(D),I={},N=A.group,M=A.isValid=!0;if(B=A.old=A.old||{},E=E||A.must,N&&(G.extend(I,N),L=N.call(H),L!==!0?(J(L)&&(L={error:L}),A.vid=0,A.rid="group",M=!1):(L=Aw,H.hideMsg(D,I,A))),!M||A.required||A.must||""!==D.value){if(!E&&B&&B.ret!==Aw&&B.value===D.value&&""!==D.value){return F.trigger("validated.field",[A,B.ret]),Aw}}else{if("tip"===Y(D,Ad)){return}if(H._focus({target:D}),!AJ(D)){return F.trigger("validated.field",[A,{isValid:!0}]),Aw}}C.debug&&Ab.log("%c"+A.key,"background:#eee"),L!==Aw?F.trigger("validated.rule",[A,L,I]):A.rule&&H._checkRule(D,A)}},_getMsgOpt:function(A){return G.extend({},this.msgOpt,J(A)?{msg:A}:A)},getField:function(B){var C,A=this;return C=B.id&&"#"+B.id in A.fields||!B.name?"#"+B.id:B.name,Y(B,Ah)&&A._parse(B),A.fields[C]},test:function(A,B){var C,D,H,E=this,F=Z.exec(B);return F?(F[3]&&(F[2]=F[3]),D=F[1],H=F[2]?G.trim(F[2]).split(", "):Aw,D in E.rules&&(C=E.rules[D].call(E,A,H)),C===!0||C===Aw||!1):!0},getRangeMsg:function(C,D,F,A){if(D){var H=this,B=H.messages[F]||"",N=D[0].split("~"),L=N[0],E=N[1],I="rg",M=[""],O=+C===+C;if(2===N.length){if(L&&E){if(O&&C>=+L&&+E>=C){return !0}M=M.concat(N)}else{if(L&&!E){if(O&&C>=+L){return !0}M.push(L),I="gt"}else{if(!L&&E){if(O&&+E>=C){return !0}M.push(E),I="lt"}}}}else{if(C===+L){return !0}M.push(L),I="eq"}return B&&(A&&B[I+A]&&(I+=A),M[0]=B[I]),H.renderMsg.apply(null,M)}},renderMsg:function(){var B=arguments,C=B[0],A=B.length;if(C){for(;--A;){C=C.replace("{"+A+"}",B[A])}return C}},_getMsgDOM:function(F,A){var B,C,D,H=G(F);if(H.is(":input")?(D=A.target||Y(F,Af),D&&(D=this.$el.find(D),D.length&&(D.is(":input")?F=D.get(0):B=D)),B||(C=!AJ(F)&&F.id?F.id:F.name,B=this.$el.find(A.wrapper+"."+K+'[for="'+C+'"]'))):B=H,!B.length){if(H=this.$el.find(D||F),B=G("<"+A.wrapper+">").attr({"class":K+(A.cls?" "+A.cls:""),style:A.style||"","for":C}),AJ(F)){var E=H.parent();B.appendTo(E.is("label")?E.parent():E)}else{B[A.pos&&"right"!==A.pos?"insertBefore":"insertAfter"](H)}}return B},showMsg:function(E,A,B){if(A=this._getMsgOpt(A),A.msg||A.showOk){E=G(E).get(0),G(E).is(":verifiable")&&(Y(E,Ad,A.type),B=B||this.getField(E),B&&(B.msgStyle&&(A.style=B.msgStyle),B.msgClass&&(A.cls=B.msgClass),B.msgWrapper&&(A.wrapper=B.msgWrapper)));var C=this._getMsgDOM(E,A),D=C[0].className;!Al.test(D)&&C.addClass(A.cls),z&&"bottom"===A.pos&&(C[0].style.marginTop=G(E).outerHeight()+"px"),C.html(((B||{}).msgMaker||this.options.msgMaker).call(this,A)),C[0].style.display="",At(A.show)&&A.show.call(this,C,A.type)}},hideMsg:function(D,A,B){D=G(D).get(0),A=this._getMsgOpt(A),G(D).is(":verifiable")&&(B=B||this.getField(D),B&&B.msgWrapper&&(A.wrapper=B.msgWrapper));var C=this._getMsgDOM(D,A);C.length&&(At(A.hide)?A.hide.call(this,C,A.type):C[0].style.display="none")},mapMsg:function(B){var A=this;G.each(B,function(D,E){var C=A.elements[D]||A.$el.find(':input[name="'+D+'"]')[0];A.showMsg(C,E)})},setMsg:function(A){new AC(A,this.messages)},setRule:function(A){new Aq(A,this.rules),G.map(this.fields,function(B){B.old={}})},setField:function(A,B){var C=this,D={};if(J(A)){if(null===B){return G.map(A.split(" "),function(E){E&&C.fields[E]&&(C.fields[E]=null)}),Aw}B&&(D[A]=B)}else{Ag(A)&&(D=A)}C.options.fields?G.extend(C.options.fields,D):C.options.fields=D,C._init()},holdSubmit:function(A){A===Aw&&(A=!0),this.submiting=A},destroy:function(){this._reset(!0),this.$el.off("."+As).removeData(As),Y(this.$el[0],Ak,this.NOVALIDATE)}},G(document).on("focusin",":input["+Ah+"]",function(){Ax(this,"focusin")}).on("click","input,button",function(){if(this.form){if("submit"===this.type&&null!==Y(this,"formnovalidate")||null!==Y(this,Ak)){Y(this.form,"novalidateonce",!0)}else{if(this.name&&AJ(this)){var A=this.form.elements[this.name];A.length&&(A=A[0]),Y(A,Ah)&&Ax(A,"validate")}}}}).on("submit","form",function(C){if(null===Y(this,Ak)){var A,B=G(this);B.data(As)||(A=B[As]().data(As),G.isEmptyObject(A.fields)?(Y(this,Ak,Ak),B.removeData(As)):"submit"===C.type&&A._submit(C))}}),new Aq({required:function(D,A){var B=G.trim(D.value),C=!0;if(A){if(1===A.length){if(!B&&!this.test(D,A[0])){return null}}else{"not"===A[0]&&G.map(A.slice(1),function(E){B===G.trim(E)&&(C=!1)})}}return C&&!!B},integer:function(B,F){var A,C="0|",D="[1-9]\\d*",E=F?F[0]:"*";switch(E){case"+":A=D;break;case"-":A="-"+D;break;case"+0":A=C+D;break;case"-0":A=C+"-"+D;break;default:A=C+"-?"+D}return A="^(?:"+A+")$",RegExp(A).test(B.value)||this.messages.integer[E]},match:function(C,E,A){var F,B,M,I,D,H,L,N="eq";if(E&&(1===E.length?M=E[0]:(N=E[0],M=E[1]),D="#"===M.charAt(0)?M:':input[name="'+M+'"]',H=this.$el.find(D)[0])){if(L=this.getField(H),F=C.value,B=H.value,A.init_match||(this.$el.on("valid.field."+As,D,function(){G(C).trigger("validate")}),A.init_match=L.init_match=1),!A.required&&""===F&&""===B){return null}if(E[2]&&("date"===E[2]?(F=AK(F),B=AK(B)):"time"===E[2]&&(F=+F.replace(":",""),B=+B.replace(":",""))),"eq"!==N&&!isNaN(+F)&&isNaN(+B)){return !0}switch(I=this.messages.match[N].replace("{1}",L.display||M),N){case"lt":return +B>+F||I;case"lte":return +B>=+F||I;case"gte":return +F>=+B||I;case"gt":return +F>+B||I;case"neq":return F!==B||I;default:return F===B||I}}},range:function(A,B){return this.getRangeMsg(+A.value,B,"range")},checked:function(E,A,B){if(!AJ(E)){return !0}var C,D;return D=this.$el.find('input[name="'+E.name+'"]').filter(function(){return !C&&AJ(this)&&(C=this),!this.disabled&&this.checked&&G(this).is(":visible")}).length,A?this.getRangeMsg(D,A,"checked"):!!D||AH(C,B,"checked")||this.messages.required},length:function(B,D){var A=B.value,C=(D[1]?A.replace(Aj,"xx"):A).length;return D&&"~"===D[0].charAt(0)&&(D[0]="0"+D[0]),this.getRangeMsg(C,D,"length",D[1]?"_2":"")},remote:function(C,E){var A,F,B,I,H=this,D={};return E?(A=Q.exec(E[0]),B=A[2],I=(A[1]||"POST").toUpperCase(),D[C.name]=C.value,E[1]&&G.map(E.slice(1),function(L){D[G.trim(L)]=H.$el.find(':input[name="'+L+'"]').val()}),D=G.param(D),"POST"===I&&(F=B.indexOf("?"),-1!==F&&(D+="&"+B.substring(F+1,B.length),B=B.substring(0,F))),G.ajax({url:B,type:I,data:D,async:!0,cache:!1})):!0},filter:function(A,B){return A.value=A.value.replace(B?RegExp("["+B[0]+"]","g"):Ae,""),!0}}),AB.config=function(A){G.each(A,function(B,C){"rules"===B?new Aq(C):"messages"===B?new AC(C):Ac[B]=C})},AB.setTheme=function(B,A){Ag(B)?G.each(B,function(C,D){Ai[C]=D}):J(B)&&Ag(A)&&(Ai[B]=A)},G[As]=AB}(jQuery);